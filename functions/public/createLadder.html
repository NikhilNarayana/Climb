<!DOCTYPE html>
<html>
<head>
	<title>Create ladder</title>
	
	 <script src="/__/firebase/5.5.8/firebase-app.js"></script>
  	<script src="/__/firebase/5.5.8/firebase-auth.js"></script>
  	<script src="/__/firebase/5.5.8/firebase-database.js"></script>
  	<script src="/__/firebase/init.js"></script>
  
	<script type="text/javascript">

	function Profile(){
		window.location = 'profile.html';
	}

	function Create(){
		console.log(document.getElementById('shortcode').textContent)
		var username, shortCode, game, maxPlayers, setLength;

		username = firebase.auth().currentUser.displayName;
		shortcode = document.getElementById('shortcode').textContent;
		game = document.getElementById('gameName').value;
		maxPlayers = document.getElementById('maxPlayers').value;
		setLength = document.getElementById('setLength').value;
		var userId = firebase.auth().currentUser.uid;
		var database = firebase.database();


		var ref = database.ref('ladders');

		ref.child(shortcode).set({
			Creator: username,
			UserId: userId,
			Game: game,
			Max_players: maxPlayers,
			Set_Length: setLength
		
		});

		var ref = database.ref('userLadders');
		ref.child(firebase.auth().currentUser.uid).set({
			ladder: shortcode
		}).then(function() {
	    	//on completion
	    	window.location = 'ladder.html';
	 	}).catch(function(error) {
	    console.log('Synchronization failed');
	  	});

	}

	function initApp(){
		console.log("triggered");

		document.getElementById('profile').addEventListener('click', Profile, false);
		document.getElementById('create-ladder').addEventListener('click', Create, false);
	}
	
	window.onload = function() {
		var ladderId = Math.random().toString(36).substr(2, 9)
		console.log(ladderId);
		document.getElementById('shortcode').textContent = ladderId;
	    initApp();
    };


	</script>

</head>
<body>
	 <h1> Ladder creation </h1>
	 Ladder ID: 
	 <code id="shortcode"></code>
	 <br><br>
	 <input class="mdl-textfield__input" style="display:inline;width:auto;" type="gameName" id="gameName" name="gameName" placeholder="Name of game"/>
	 <br/><br/>
	 Best of
	 <select style="display:inline; width:auto;" type="setLength" id="setLength" name="setLength">
	 	<option value="1">1</option>
	 	<option value="3">3</option>
	 	<option value="5">5</option>
	 </select>
	 <br/><br/>
	 <input class="mdl-textfield__input" style="display:inline;width:auto;" type="number" min=2 value=2 id="maxPlayers" name="maxPlayers" placeholder="Player limit"/>
	 <br/><br/>
	<button class="mdl-button mdl-js-button mdl-button--raised" id="create-ladder" name="name">Create</button>
	<br/><br/>
	<button class="mdl-button mdl-js-button mdl-button--raised" id="profile" name="signup">Profile</button>
	
</body>
</html>